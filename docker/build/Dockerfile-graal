FROM oracle/graalvm-ce:19.3.1-java11

LABEL maintainer "MAIF <oss@maif.fr>"

RUN groupadd -g 999 otoroshi && useradd -r -u 999 -g otoroshi otoroshi

RUN mkdir -p /otoroshi

WORKDIR /otoroshi

COPY ./otoroshi.jar /otoroshi
COPY ./entrypoint-graal.sh /otoroshi

RUN mkdir /otoroshi/conf \
  && mkdir /otoroshi/filedb \
  && mkdir /otoroshi/imports

RUN chown -R otoroshi:otoroshi /otoroshi

VOLUME /otoroshi/imports
VOLUME /otoroshi/filedb
VOLUME /otoroshi/conf
VOLUME /otoroshi

# RUN native-image -H:+ReportUnsupportedElementsAtRuntime --verbose --delay-class-initialization-to-runtime=play.api.Play$ -jar otoroshi.jar 

ENTRYPOINT ["./entrypoint-graal.sh"]

USER otoroshi

EXPOSE 8080

STOPSIGNAL SIGINT

CMD [""]
