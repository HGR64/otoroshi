<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Managing services · Otoroshi</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='otoroshi-manual'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Otoroshi
</a>
<div class="version-number">
1.0.0
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../about.html" class="page">About Otoroshi</a></li>
  <li><a href="../archi.html" class="page">Architecture</a></li>
  <li><a href="../features.html" class="page">Features</a></li>
  <li><a href="../quickstart.html" class="page">Try Otoroshi in 5 minutes</a></li>
  <li><a href="../videos.html" class="page">Video tutorials</a></li>
  <li><a href="../getotoroshi/index.html" class="page">Get Otoroshi</a>
  <ul>
    <li><a href="../getotoroshi/fromsources.html" class="page">From sources</a></li>
    <li><a href="../getotoroshi/frombinaries.html" class="page">From binaries</a></li>
    <li><a href="../getotoroshi/fromdocker.html" class="page">From docker</a></li>
  </ul></li>
  <li><a href="../firstrun/index.html" class="page">First run</a>
  <ul>
    <li><a href="../firstrun/datastore.html" class="page">Choose your datastore</a></li>
    <li><a href="../firstrun/configfile.html" class="page">Config. with files</a></li>
    <li><a href="../firstrun/env.html" class="page">Config. with ENVs</a></li>
    <li><a href="../firstrun/initialstate.html" class="page">Import initial state</a></li>
    <li><a href="../firstrun/host.html" class="page">Setup your hosts</a></li>
    <li><a href="../firstrun/run.html" class="page">Run Otoroshi</a></li>
  </ul></li>
  <li><a href="../setup/index.html" class="page">Setup Otoroshi</a>
  <ul>
    <li><a href="../setup/admin.html" class="page">Manage admin users</a></li>
    <li><a href="../setup/dangerzone.html" class="page">Configure the Danger zone</a></li>
  </ul></li>
  <li><a href="../usage/index.html" class="page">Using Otoroshi</a>
  <ul>
    <li><a href="../usage/1-groups.html" class="page">Managing service groups</a></li>
    <li><a href="../usage/2-services.html" class="active page">Managing services</a></li>
    <li><a href="../usage/3-apikeys.html" class="page">Managing api keys</a></li>
    <li><a href="../usage/4-monitor.html" class="page">Monitoring services</a></li>
    <li><a href="../usage/5-sessions.html" class="page">Managing sessions</a></li>
    <li><a href="../usage/6-audit.html" class="page">Auditing Otoroshi</a></li>
    <li><a href="../usage/7-metrics.html" class="page">Otoroshi global metrics</a></li>
    <li><a href="../usage/8-importsexports.html" class="page">Import and export</a></li>
  </ul></li>
  <li><a href="../integrations/index.html" class="page">Third party Integrations</a>
  <ul>
    <li><a href="../integrations/analytics.html" class="page">Analytics</a></li>
    <li><a href="../integrations/auth0.html" class="page">Auth0</a></li>
    <li><a href="../integrations/mailgun.html" class="page">Mailgun</a></li>
    <li><a href="../integrations/statsd.html" class="page">StatsD / Datadog</a></li>
    <li><a href="../integrations/clevercloud.html" class="page">Clever Cloud</a></li>
  </ul></li>
  <li><a href="../api.html" class="page">Admin REST API</a></li>
  <li><a href="../cli.html" class="page">Rust CLI</a></li>
  <li><a href="../deploy/index.html" class="page">Deploy to production</a>
  <ul>
    <li><a href="../deploy/clevercloud.html" class="page">Clever Cloud</a></li>
    <li><a href="../deploy/other.html" class="page">Others</a></li>
    <li><a href="../deploy/scaling.html" class="page">Scaling Otoroshi *</a></li>
  </ul></li>
  <li><a href="../connectors/index.html" class="page">Connectors</a>
  <ul>
    <li><a href="../connectors/clevercloud.html" class="page">Clever Cloud *</a></li>
    <li><a href="../connectors/kubernetes.html" class="page">Kubernetes *</a></li>
    <li><a href="../connectors/rancher.html" class="page">Rancher *</a></li>
    <li><a href="../connectors/elastic.html" class="page">Elastic *</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title-wrapper">
<div class="title-logo"></div>
<div class="title"><a href="../index.html">Otoroshi</a></div>
</div>
<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Otoroshi
</a>
<div class="version-number">
1.0.0
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../about.html" class="page">About Otoroshi</a></li>
  <li><a href="../archi.html" class="page">Architecture</a></li>
  <li><a href="../features.html" class="page">Features</a></li>
  <li><a href="../quickstart.html" class="page">Try Otoroshi in 5 minutes</a></li>
  <li><a href="../videos.html" class="page">Video tutorials</a></li>
  <li><a href="../getotoroshi/index.html" class="page">Get Otoroshi</a>
  <ul>
    <li><a href="../getotoroshi/fromsources.html" class="page">From sources</a></li>
    <li><a href="../getotoroshi/frombinaries.html" class="page">From binaries</a></li>
    <li><a href="../getotoroshi/fromdocker.html" class="page">From docker</a></li>
  </ul></li>
  <li><a href="../firstrun/index.html" class="page">First run</a>
  <ul>
    <li><a href="../firstrun/datastore.html" class="page">Choose your datastore</a></li>
    <li><a href="../firstrun/configfile.html" class="page">Config. with files</a></li>
    <li><a href="../firstrun/env.html" class="page">Config. with ENVs</a></li>
    <li><a href="../firstrun/initialstate.html" class="page">Import initial state</a></li>
    <li><a href="../firstrun/host.html" class="page">Setup your hosts</a></li>
    <li><a href="../firstrun/run.html" class="page">Run Otoroshi</a></li>
  </ul></li>
  <li><a href="../setup/index.html" class="page">Setup Otoroshi</a>
  <ul>
    <li><a href="../setup/admin.html" class="page">Manage admin users</a></li>
    <li><a href="../setup/dangerzone.html" class="page">Configure the Danger zone</a></li>
  </ul></li>
  <li><a href="../usage/index.html" class="page">Using Otoroshi</a>
  <ul>
    <li><a href="../usage/1-groups.html" class="page">Managing service groups</a></li>
    <li><a href="../usage/2-services.html" class="active page">Managing services</a></li>
    <li><a href="../usage/3-apikeys.html" class="page">Managing api keys</a></li>
    <li><a href="../usage/4-monitor.html" class="page">Monitoring services</a></li>
    <li><a href="../usage/5-sessions.html" class="page">Managing sessions</a></li>
    <li><a href="../usage/6-audit.html" class="page">Auditing Otoroshi</a></li>
    <li><a href="../usage/7-metrics.html" class="page">Otoroshi global metrics</a></li>
    <li><a href="../usage/8-importsexports.html" class="page">Import and export</a></li>
  </ul></li>
  <li><a href="../integrations/index.html" class="page">Third party Integrations</a>
  <ul>
    <li><a href="../integrations/analytics.html" class="page">Analytics</a></li>
    <li><a href="../integrations/auth0.html" class="page">Auth0</a></li>
    <li><a href="../integrations/mailgun.html" class="page">Mailgun</a></li>
    <li><a href="../integrations/statsd.html" class="page">StatsD / Datadog</a></li>
    <li><a href="../integrations/clevercloud.html" class="page">Clever Cloud</a></li>
  </ul></li>
  <li><a href="../api.html" class="page">Admin REST API</a></li>
  <li><a href="../cli.html" class="page">Rust CLI</a></li>
  <li><a href="../deploy/index.html" class="page">Deploy to production</a>
  <ul>
    <li><a href="../deploy/clevercloud.html" class="page">Clever Cloud</a></li>
    <li><a href="../deploy/other.html" class="page">Others</a></li>
    <li><a href="../deploy/scaling.html" class="page">Scaling Otoroshi *</a></li>
  </ul></li>
  <li><a href="../connectors/index.html" class="page">Connectors</a>
  <ul>
    <li><a href="../connectors/clevercloud.html" class="page">Clever Cloud *</a></li>
    <li><a href="../connectors/kubernetes.html" class="page">Kubernetes *</a></li>
    <li><a href="../connectors/rancher.html" class="page">Rancher *</a></li>
    <li><a href="../connectors/elastic.html" class="page">Elastic *</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Otoroshi</a></li>
  <li><a href="../usage/index.html">Using Otoroshi</a></li>
  <li>Managing services</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#managing-services" name="managing-services" class="anchor"><span class="anchor-link"></span></a>Managing services</h1>
<p>Now let&rsquo;s create some services. Services or <code>service descriptor</code> let you declare how to proxy a call from a domain name to another domain name (or multiple). Let say I have an API exposed at <code>http://192.168.0.42</code> and I want to expose it at <code>https://my.api.foo</code>. Otoroshi will proxy all calls to <code>https://my.api.foo</code> and forward them to <code>http://192.168.0.42</code>. While doing that, it will also log everyhting, control accesses, etc .</p>
<h2><a href="#otoroshi-entities" name="otoroshi-entities" class="anchor"><span class="anchor-link"></span></a>Otoroshi entities</h2>
<p>There are 3 major entities at the core of Otoroshi</p>
<ul>
  <li>service groups</li>
  <li><strong>service descriptors</strong></li>
  <li>api keys</li>
</ul><div class="centered-img">
<img src="../img/models-service.png" /></div>
<p>A <code>service descriptor</code> is contained in a <code>service group</code> and is allowed to be accessed by all the <code>api key</code>s authorized on the <code>service group</code>.</p>
<h2><a href="#create-a-service-descriptor" name="create-a-service-descriptor" class="anchor"><span class="anchor-link"></span></a>Create a service descriptor</h2>
<p>To create a <code>service descriptor</code>, click on <code>Add service</code> on the Otoroshi sidebar. Then you will be asked to choose a name for the service what is the group of the service. You also have two buttons to create a new group and assign it to the service and create a new group with a name based on the service name.</p>
<p>You will have a serie of toggle buttons to</p>
<ul>
  <li>activate / deactivate a service</li>
  <li>display maintenance page for a service</li>
  <li>display contruction page for a service</li>
  <li>enforce secure exchange between services</li>
  <li>force https usage on the exposed service</li>
</ul>
<p>and then, you will be able to choose the URL that will be used to reach your new service on Otoroshi.</p><div id="service-flags" class="centered-img">
<img src="../img/new-service-flags.png" /></div>
<p>in the <code>service targets</code> section, you will be able to choose where the call will be forwarded. You can use multiple target, in that case, Otoroshi will perform a round robin load balancing between the targets. You can also specify a target root, if you say that the target root is <code>/foo/</code>, then any call to <code>https://my.api.foo</code> will call <code>http://192.168.0.42/foo/</code> and nay call to <code>https://my.api.foo/bar</code> will call <code>http://192.168.0.42/foo/bar</code>.</p>
<p>In the URL patterns section, you will be able to choose which URL will be private and which URL will be public. By default all service are private and each call must provide an <code>api key</code>. But sometimes, you need to access a service publicly. In that case, you can provide patterns (regex) to make some or all URL public (for example with the pattern <code>/.*</code>). You also have a private pattern field to restrict public patterns.</p><div id="targets" class="centered-img">
<img src="../img/new-service-patterns.png" /></div>
<h3><a href="#secure-exchange" name="secure-exchange" class="anchor"><span class="anchor-link"></span></a>Secure exchange</h3>
<p>if you change to enable secure communication for a service, then you will have to add a filter on the target application that will take the <code>Otoroshi-State</code> header and return it in a header named <code>Otoroshi-State-Resp</code>. Otoroshi is also sending a <code>JWT token</code>in a header named <code>Otoroshi-Claim</code> that the target app can validate.</p><div class="centered-img">
<img src="../img/exchange.png" /></div>
<h3><a href="#canary-mode" name="canary-mode" class="anchor"><span class="anchor-link"></span></a>Canary mode</h3>
<p>Otoroshi provides a feature called <code>Canary mode</code>. It let you define new targets for a service, and route a percentage of the traffic on those targets. It&rsquo;s a good way of testing a new version of a service before public release. As any client need to be routed to the same version of targets any time, Otoroshi will issue a special header and a cookie containing a <code>session id</code>. The header is named <code>Otoroshi-Canary-Id</code>.</p><div class="centered-img">
<img src="../img/new-service-canary.png" /></div>
<h3><a href="#service-health-check" name="service-health-check" class="anchor"><span class="anchor-link"></span></a>Service health check</h3>
<p>Otoroshi is also capable of checking the health of a service. You can define a URL that will be tested, and Otoroshi will ping that URL regularly. Will doing so, Otoroshi will pass a numeric value in a header named <code>Otoroshi-Health-Check-Logic-Test</code>. You can respond with a header named <code>Otoroshi-Health-Check-Logic-Test-Result</code> that contains the value of <code>Otoroshi-Health-Check-Logic-Test</code> + 42 to indicate that the service is working properly.</p><div class="centered-img">
<img src="../img/new-service-healthcheck.png" /></div>
<h3><a href="#service-circuit-breaker" name="service-circuit-breaker" class="anchor"><span class="anchor-link"></span></a>Service circuit breaker</h3>
<p>In Otoroshi, each service has its own client settings with a circuit breaker and some retry capabilities. In the <code>Client settings</code> section, you will be able to customize the client behavior.</p><div class="centered-img">
<img src="../img/new-service-client.png" /></div>
<h3><a href="#service-settings" name="service-settings" class="anchor"><span class="anchor-link"></span></a>Service settings</h3>
<p>You can also provide some additionnal informations about a service, like an <code>Open API</code> descriptor, some metadata, a list of whitelisted/blacklisted ip addresses, etc.</p>
<p>Here you can also define some headers that will be added to each request to the targets. And you will be able to define headers to route the call only if the defined header is present on the request.</p><div id="service-meta" class="centered-img">
<img src="../img/new-service-meta.png" /></div>
<h3><a href="#custom-error-templates" name="custom-error-templates" class="anchor"><span class="anchor-link"></span></a>Custom error templates</h3>
<p>finally, you can define custom error templates that will be displayed when an error occurs when Otoroshi try to reach the target or when Otoroshi itself has an error. You can also define custom template for maintenance and service page</p>
<div class="nav-next">
<p><strong>Next:</strong> <a href="../usage/3-apikeys.html">Managing api keys</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../usage/2-services.html#managing-services" class="header">Managing services</a>
  <ul>
    <li><a href="../usage/2-services.html#otoroshi-entities" class="header">Otoroshi entities</a></li>
    <li><a href="../usage/2-services.html#create-a-service-descriptor" class="header">Create a service descriptor</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2018</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
